import{s as P,r as T,o as c,c as i,a as e,t as r,u as t,j as Q,H as J,b as A,n as X,q as Z,Q as ee,K as H,x as S,y as I,G as te,_ as G,p as se,e as ae,F as R,i as z,d as $,m as ne,C as oe,v as le,P as V,w as ce}from"./entry.32UGFqj-.js";import{_ as ie}from"./logo.fw.cSq0cuzg.js";import{u as F,n as C,c as de,T as re,D as _e,C as j,a as ue}from"./attendancePortal.j6cfMurj.js";import{_ as me}from"./AnnouncementTimeline.Dcd5FNCb.js";import{u as pe}from"./vue.f36acd1f.Ds2AlAv6.js";import{u as fe}from"./announcements.BPtJu5_q.js";import{m as ge,s as he,d as ve,r as xe}from"./interval.BLVulaED.js";import{_ as ye}from"./LayoutBoards.vue.D_rbqYxd.js";import"./CustomFetch.ggXvTdIz.js";import"./loader.BQ9QddgL.js";const we={class:"w-full"},be={class:"bg-zinc-100 p-4"},$e={class:"flex flex-col md:flex-row justify-between items-center"},Ae=J('<div class="w-1/3 flex items-center space-x-4 mb-4 md:mb-0 md:mr-4"><a href="/" class="flex items-center justify-between"><img src="'+ie+'" class="mr-3 h-12" alt="Sigma Logo"><span class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white"></span></a><div class="text-sm text-zinc-700"><p class="font-bold"> Employee Attendance Portal </p><p> Facial Recognition </p></div></div>',1),Te={class:"w-1/3 text-center mb-4 md:mb-0"},ke={class:"text-3xl font-bold"},Ee={key:0,class:"text-sm"},Pe={class:"w-1/3 text-sm text-zinc-700 flex justify-end px-2"},Le={id:"timerHeader",class:"font-bold text-3xl"},Se={class:"text-lg"},Fe={__name:"employee-attendance-header",setup(v){const p=F(),{attendanceSession:a,currentDate:m,currentTime:s}=P(p),n=T(null);return(async()=>{await p.getCurrentDate(),m.value=m.value.toDateString();let o=0;const f=x=>{x-o>=1e3&&(s.value.setSeconds(s.value.getSeconds()+1),n.value=s.value.toLocaleTimeString(),o=x),requestAnimationFrame(f)};requestAnimationFrame(f)})(),(o,f)=>(c(),i("div",we,[e("div",be,[e("div",$e,[Ae,e("div",Te,[e("h1",ke,r(t(a).currentName||(t(a).assignment_count>1?"Multiple Assignments":t(a).name)),1),typeof t(a)=="array"?(c(),i("p",Ee," press arrowkey to change ")):Q("",!0)]),e("div",Pe,[e("div",null,[e("p",Le,r(t(n)),1),e("p",Se,r(t(m)),1)])])])])]))}},Me={class:"w-full max-h-full"},Ce={__name:"EmployeeAnouncement",setup(v){return fe().getactiveAll(),pe({title:"Dashboard",meta:[{name:"description",content:"SIGMA Dashboard"}],bodyAttrs:{class:"test"}}),(a,m)=>{const s=me;return c(),i("div",Me,[A(s)])}}},W=v=>(se("data-v-fe98b97f"),v=v(),ae(),v),De={id:"FaceCamera Component"},Ne=W(()=>e("video",{id:"cameraPreview",class:"w-50 h-50 -scale-x-100",autoplay:"",muted:""},null,-1)),je=[Ne],Ie={class:"bg-gray-300 p-2 text-center font-bold text-xl"},Re={key:0},ze={key:1,class:"text-green-500"},Oe={key:2,class:"text-red-600"},Be={key:3},Ue=W(()=>e("div",{id:"capturedImage",class:"absolute top-0 m-auto"},null,-1)),D="/faceapimodels",Ve={__name:"FaceCamera",props:{isPaused:{type:Boolean,default:!1}},emits:X(["resetPortalData"],["update:isPaused"]),setup(v,{emit:p}){const a=F(),{attendanceSession:m}=P(a),{newAttendanceLog:s}=P(a),n=T(null),_=T(null),o=T(4),f=T(null),x=T(null),l=T("");let d=null,g=null,h=null,y=null,k=null;const w=Z(v,"isPaused");ee(()=>{g&&g.getTracks().forEach(u=>{u.stop()})});const E=()=>{Promise.all([C.ssdMobilenetv1.loadFromUri(D),C.tinyFaceDetector.loadFromUri(D),C.faceLandmark68Net.loadFromUri(D),C.faceRecognitionNet.loadFromUri(D)]).then(async()=>{d=document.getElementById("cameraPreview"),g=await navigator.mediaDevices.getUserMedia({video:!0}),d.srcObject=g,await new Promise(u=>{d.onloadedmetadata=()=>{d.play(),u()}}),d.addEventListener("play",N())})},N=()=>{h=de(d),y=h.getContext("2d"),document.getElementById("capturedImage").append(h),k={width:d.clientWidth,height:d.clientHeight},ge(h,k),m.value.assignment_count>1&&(w.value=!0),b()},b=()=>{he(async()=>{w.value||(y.clearRect(0,0,h.width,h.height),n.value=await ve(d,new re).withFaceLandmarks().withFaceDescriptor(),n.value?L():(o.value=4,_.value=null))},250)},L=()=>{const u=a.faceMatcher.findBestMatch(n.value.descriptor).toString(!1);u==="unknown"?(_.value=null,o.value=4,B(u)):O(u)},O=u=>{B(a.faceNames[u]),a.newAttendanceLog.data.employee_id=u,u===_.value?o.value--:(o.value=4,_.value=u),o.value===0&&q(u)},B=u=>{const M=xe(n.value,k).detection.box;M._x=d.clientWidth-M.x-M.width,new _e(M,{label:u}).draw(h)},q=async u=>{if(!s.value.isLoading)try{l.value="Saving...",await a.saveAttendanceLog(),s.value.successMessage="Successfully Logged "+a.newAttendanceLog.data.log_type,a.getTodayAttendanceLogs(),f.value=u,x.value=a.newAttendanceLog.data.log_type}finally{setTimeout(()=>{o.value=4,m.value.assignment_count>1&&(p("resetPortalData"),w.value=!0,m.value.currentName="")},100),Y()}};H(()=>{E()});let U=null;const Y=()=>{clearTimeout(U),U=setTimeout(()=>{a.lastSuccessLogEmployee=null,s.value.successMessage="",s.value.errorMessage="",l.value=""},5e3)};return(u,K)=>(c(),i("div",De,[e("div",{class:te(["relative justify-center w-full",{hideCanvas:w.value}])},[S(e("div",null,je,512),[[I,!w.value]]),e("div",Ie,[t(o)<=3&&t(o)>0?(c(),i("p",Re," TIMER: "+r(t(o)>=0?t(o).toFixed(0):0),1)):t(s).successMessage?(c(),i("p",ze,r(t(s).successMessage),1)):t(s).errorMessage?(c(),i("p",Oe,r(t(s).errorMessage),1)):(c(),i("p",Be,r(t(l)!==""?t(l):"..."),1))]),Ue],2)]))}},He=G(Ve,[["__scopeId","data-v-fe98b97f"]]),Ge={class:"bg-gray-100 flex gap-2 w-full shadow-lg border-2 border-gray-300 rounded-lg p-4"},We={class:"md:w-1/4"},qe=["src"],Ye=["src"],Ke={class:"md:w-3/4 flex flex-col justify-start"},Qe={class:"text-3xl text-gray-700 font-bold mt-2"},Je={class:"grid grid-cols-2 gap-4 mt-4"},Xe={class:"text-zinc-600 dark:text-zinc-300"},Ze=e("span",{class:"text-cyan-900 font-bold"},"TIME-IN :",-1),et={class:"text-zinc-600 dark:text-zinc-300"},tt=e("span",{class:"text-cyan-900 font-bold"},"TIME-OUT :",-1),st={__name:"employee-attendance-card",setup(v){const p=F(),{lastSuccessLogEmployee:a}=P(p);return(m,s)=>{var n,_,o,f,x,l,d,g,h;return c(),i("div",Ge,[e("div",We,[(_=(n=t(a))==null?void 0:n.employee)!=null&&_.profile_photo&&((f=(o=t(a))==null?void 0:o.employee)!=null&&f.profile_photo.base64)&&((l=(x=t(a))==null?void 0:x.employee)==null?void 0:l.profile_photo.base64)!=="File doesn't exists."?(c(),i("img",{key:0,class:"max-w-32 max-h-32 bg-gray-400 rounded-lg",src:(d=t(a))==null?void 0:d.employee.profile_photo.base64,alt:"profile pic"},null,8,qe)):(c(),i("img",{key:1,class:"max-w-32 max-h-32 bg-gray-400 rounded-lg",src:"/avatarexample.png",alt:"profile pic"},null,8,Ye))]),e("div",Ke,[e("p",Qe,r(((g=t(a))==null?void 0:g.employee.fullname_first)??"..."),1),e("div",Je,[(c(!0),i(R,null,z((h=t(a))==null?void 0:h.schedule,(y,k)=>{var w,E;return c(),i("div",{key:"empattc"+k},[e("p",null,r(y.day_of_week_names_short.toString())+" "+r(y.start_time_human)+" - "+r(y.end_time_human),1),e("p",Xe,[Ze,$(" "+r((w=y.applied_ins)==null?void 0:w.time_human),1)]),e("p",et,[tt,$(" "+r((E=y.applied_outs)==null?void 0:E.time_human),1)])])}),128))])])])}}},at={class:"max-h-full overflow-auto"},nt={class:"text-xl text-gray-700 font-bold"},ot={class:"flex-col gap-4"},lt={class:"flex justify-between gap-x-6"},ct={class:"text-xl text-zinc-600 dark:text-zinc-300"},it=e("span",{class:"text-cyan-900 font-bold"},null,-1),dt={class:"text-xl text-zinc-600 dark:text-zinc-300"},rt=e("span",{class:"text-cyan-900 font-bold"},null,-1),_t={class:"text-xl text-zinc-600 dark:text-zinc-300"},ut=e("span",{class:"text-cyan-900 font-bold"},null,-1),mt={__name:"employee-attendance-log-card",setup(v){const p=F(),{attendanceLogList:a}=P(p);return(m,s)=>(c(),i("div",at,[(c(!0),i(R,null,z(t(a),(n,_)=>(c(),i("div",{key:_,class:"flex gap-4 justify-between py-4 px-2"},[e("p",nt,r(n.employee.fullname_last),1),e("div",ot,[e("div",lt,[e("p",ct,[it,$(" "+r(n.attendance_type),1)]),e("p",dt,[rt,$(" "+r(n.log_type),1)]),e("p",_t,[ut,$(" "+r(n.time_human),1)])])])]))),128))]))}},pt={},ft={class:"w-full flex bg-gray-200 text-gray-700 h-12 px-4 justify-between"},gt=e("div",{class:"w-1/3 flex flex-col justify-center"},[e("p",null,"Powered By: Engtech Global Solutions Inc.")],-1),ht=e("div",{class:"w-1/3 flex flex-col justify-center text-center"},[e("p",null,"EVENPAR CONSTRUCTION AND DEVELOPMENT CORPORATION")],-1),vt=e("div",{class:"w-1/3 flex flex-col justify-center text-right"},[e("p",null,"tel No: (085) 8080398")],-1),xt=[gt,ht,vt];function yt(v,p){return c(),i("div",ft,xt)}const wt=G(pt,[["render",yt]]),bt={key:0,id:"attendance-face-recognition-page",class:"w-full flex flex-col h-screen overflow-hidden gap-2"},$t={class:"w-full"},At={class:"flex-1 overflow-hidden flex gap-2 p-2"},Tt={class:"w-full md:w-1/3 max-h-full min-h-full"},kt={class:"w-full md:w-1/3 space-y-4"},Et={class:"text-center"},Pt={class:"w-full"},Lt={class:"text-center"},St=e("h2",{class:"text-3xl font-bold"}," Select Assignment ",-1),Ft={class:"text-sm"},Mt={class:"grid grid-cols-2 gap-2"},Ct=["onClick"],Dt={class:"md:flex gap-2 space-x-2 p-2 pb-0 justify-center"},Nt=e("label",{for:"Time-in",class:"mr-4 text-xs text-gray-900 dark:text-gray-300"},"TIME IN",-1),jt=e("label",{for:"time-out",class:"mr-4 text-xs text-gray-900 dark:text-gray-300"},"TIME OUT",-1),It=e("div",{class:"text-center"},[e("p",{class:"text-sm"}," Press Space to toggle ")],-1),Rt={class:"w-full"},zt={class:"w-full md:w-1/3 max-h-full h-full"},Ot={class:"w-full max-h-[94%] h-full overflow-auto"},Bt={class:"w-full"},Ut={key:1,class:"w-full text-center justify-center mt-5"},Vt=e("p",{class:"text-red-700 text-xl"},[$(" This device is using an outdated Attendance Portal."),e("br"),$(" Please ask for an authorized person for help. ")],-1),Ht=[Vt],Gt={key:2,class:"w-full text-center justify-center mt-5"},Wt=e("p",{class:"text-red-700 text-xl"},[$(" This device is not a recognized Attendance Portal."),e("br"),$(" Please use a designated Attendance Portal, or ask an authorized person for help. ")],-1),qt=[Wt],os={__name:"face-recognition",async setup(v){let p,a;const m=F(),{newAttendanceLog:s,attendanceSession:n}=P(m);m.getAllEmployeePattern(),m.getTodayAttendanceLogs(),[p,a]=ne(()=>m.checkSession()),await p,a(),s.value.log_type=j;const _=T(!1);H(()=>{n.value.assignment_count===1&&f(0),document.addEventListener("keyup",l=>{(l.key===" "||l.code==="Space"||l.keyCode===32)&&(s.value.data.log_type=s.value.data.log_type===j?ue:j),_.value&&o.value.forEach((d,g)=>{String(l.key)===(g+1).toString()&&f(g)}),n.value.assignment_count>1&&(l.key==="Escape"||l.code==="Escape"||l.keyCode===27)&&(_.value=!0,x())})});const o=oe(()=>[...n.value.departments,...n.value.projects]),f=l=>{_.value=!1,o.value[l].department_name?(s.value.data.assignment_type="Department",s.value.data.department_id=o.value[l].id,n.value.currentName="Employee's Work Location"):(s.value.data.assignment_type="Project",s.value.data.project_id=o.value[l].id,n.value.currentName=o.value[l].project_code)},x=()=>{s.value.data.assignment_type=null,s.value.data.department_id=null,s.value.data.project_id=null,n.value.currentName=""};return(l,d)=>{const g=Fe,h=Ce,y=He,k=st,w=mt,E=ye,N=wt;return t(n)?(c(),i("div",bt,[e("div",$t,[A(g)]),e("div",At,[e("div",Tt,[A(h)]),e("div",kt,[e("div",Et,[e("div",Pt,[S(e("div",null,[e("div",Lt,[St,e("p",Ft," Press 1-"+r(t(n).assignment_count)+" to select ",1)]),e("div",Mt,[(c(!0),i(R,null,z(t(o),(b,L)=>(c(),i("div",{key:"attendanceValueSelector"+L,class:"text-center cursor-pointer w-full bg-gray-100 p-2 shadow-lg border-2 border-gray-300 rounded-lg",onClick:O=>f(L)}," ["+r(L+1)+"] "+r(b.project_code??"Employee's Work Location"),9,Ct))),128))])],512),[[I,t(_)]]),S(e("div",null," (Esc) To cancel selection ",512),[[I,!t(_)&&t(n).assignment_count>1]]),A(y,{"is-paused":t(_),"onUpdate:isPaused":d[0]||(d[0]=b=>le(_)?_.value=b:null),onResetPortalData:x},null,8,["is-paused"]),e("div",null,[e("div",Dt,[S(e("input",{id:"Time-in","onUpdate:modelValue":d[1]||(d[1]=b=>t(s).data.log_type=b),class:"",type:"radio",value:"In"},null,512),[[V,t(s).data.log_type]]),Nt,S(e("input",{id:"time-out","onUpdate:modelValue":d[2]||(d[2]=b=>t(s).data.log_type=b),class:"",type:"radio",value:"Out"},null,512),[[V,t(s).data.log_type]]),jt]),It])])]),e("div",Rt,[A(k)])]),e("div",zt,[A(E,{title:"Todays Logs",class:"max-h-full h-full"},{default:ce(()=>[e("div",Ot,[A(w)])]),_:1})])]),e("div",Bt,[A(N)])])):l.fixAttendancePortal?(c(),i("div",Ut,Ht)):(c(),i("div",Gt,qt))}}};export{os as default};
