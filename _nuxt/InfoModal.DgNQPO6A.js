import{_ as O}from"./RequestDetails._HVJ---j.js";import{_ as C}from"./ApprovalDenyButton.B1ShEyLo.js";import{_ as T}from"./PsHoverButton.Dp5LwncM.js";import{_ as D}from"./PsModal.DW9SixU3.js";import{l as S,n as U,q as P,s as $,r as v,B,o as h,h as H,w as y,b as p,u as n,c as f,v as M,j as _}from"./entry.R6V7NTxy.js";import{a as R,u as I,A as V}from"./Accessibilities.uaboihcy.js";import{b as i,c as F}from"./CustomFetch.BRBLzGci.js";const j=S("overtimes",{state:()=>({createData:{isLoading:!1,errorMessage:"",successMessage:""},isEdit:!1,overtime:{id:null,employees:[],charging:"",project_id:null,department_id:null,overtime_date:null,overtime_start_time:"",overtime_end_time:"",reason:null,meal_deduction:!1,approvals:[],request_status:""},list:[],allList:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{},errorMessage:"",successMessage:""},approvalList:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{},errorMessage:"",successMessage:""},myRequestList:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{},errorMessage:"",successMessage:""},pagination:{},getParams:{},errorMessage:"",successMessage:"",remarks:""}),actions:{async getOne(e){return await i("/api/overtime/resource/"+e,{method:"GET",params:this.getParams,onResponse:({response:s})=>{if(s.ok)return s._data.data;throw new Error(s._data.message)}})},async getOvertime(){await i("/api/overtime/resource",{method:"GET",params:this.allList.params,onRequest:()=>{this.allList.isLoading=!0,this.allList.list=[]},onResponseError:({response:e})=>{throw new Error(e._data.message)},onResponse:({response:e})=>{this.allList.isLoading=!1,e.ok&&(this.allList.isLoaded=!0,this.allList.list=e._data.data,this.allList.pagination={first_page:e._data.links.first,pages:e._data.meta.links,last_page:e._data.links.last})}})},async getMyRequests(){await i("/api/overtime/my-request",{method:"GET",params:this.myRequestList.params,onRequest:()=>{this.myRequestList.isLoading=!0,this.myRequestList.list=[]},onResponseError:({response:e})=>{throw new Error(e._data.message)},onResponse:({response:e})=>{this.myRequestList.isLoading=!1,e.ok&&(this.myRequestList.isLoaded=!0,this.myRequestList.list=e._data.data,this.myRequestList.pagination={first_page:e._data.links.first,pages:e._data.meta.links,last_page:e._data.links.last})}})},async getMyApprovalRequests(){await i("/api/overtime/my-approvals",{method:"GET",params:this.approvalList.params,onRequest:()=>{this.approvalList.isLoading=!0,this.approvalList.list=[]},onResponseError:({response:e})=>{throw new Error(e._data.message)},onResponse:({response:e})=>{this.approvalList.isLoading=!1,e.ok&&(this.approvalList.isLoaded=!0,this.approvalList.list=e._data.data,this.approvalList.pagination={first_page:e._data.links.first,pages:e._data.meta.links,last_page:e._data.links.last})}})},async createRequest(){this.createData.isLoading||(this.successMessage="",this.errorMessage="",await i("/api/overtime/resource",{method:"POST",body:this.overtime,onRequest:()=>{this.createData.isLoading=!0},onResponseError:({response:e})=>{this.errorMessage=e._data.message,this.createData.isLoading=!1},onResponse:({response:e})=>{this.createData.isLoading=!1,e.ok?(this.$reset(),this.getMyApprovalRequests(),this.getOvertime(),this.getMyRequests(),this.successMessage=e._data.message):this.errorMessage=e._data.message}}))},clearMessages(){this.errorMessage="",this.successMessage=""},async editRequest(){this.successMessage="",this.errorMessage="",await i("/api/overtime/resource/"+this.overtime.id,{method:"PATCH",body:this.overtime,onResponse:({response:e})=>{e.ok?(this.$reset(),this.getMyApprovalRequests(),this.getOvertime(),this.getMyRequests(),this.successMessage=e._data.message):this.errorMessage=e._data.message}})},async deleteRequest(e){const{data:s,error:a}=await F("/api/overtime/resource/"+e,{method:"DELETE",watch:!1,onResponse:({response:d})=>{d.ok&&(this.$reset(),this.getOvertime(),this.successMessage=d._data.message)}});if(a.value)throw this.errorMessage=a.value.data.message,new Error(this.errorMessage);if(s.value)return this.getOvertime(),s},async approveApprovalForm(e){this.successMessage="",this.errorMessage="",await i("/api/approvals/approve/Overtime/"+e,{method:"POST",onResponseError:({response:s})=>{throw this.errorMessage=s._data.message,new Error(s._data.message)},onResponse:({response:s})=>{if(s.ok)return this.successMessage=s._data.message,this.getMyApprovalRequests(),this.getOvertime(),this.getMyRequests(),s._data;throw this.errorMessage=s._data.message,new Error(s._data.message)}})},async denyApprovalForm(e){this.successMessage="",this.errorMessage="";const s=new FormData;s.append("id",e),s.append("remarks",this.remarks),await i("/api/approvals/disapprove/Overtime/"+e,{method:"POST",body:s,onResponseError:({response:a})=>{throw this.errorMessage=a._data.message,new Error(a._data.message)},onResponse:({response:a})=>{if(a.ok)return this.successMessage=a._data.message,this.getMyApprovalRequests(),this.getOvertime(),this.getMyRequests(),a._data}})},async voidRequest(e,s){await i("/api/request-voids/void/Overtime/"+e,{method:"POST",params:{reason_for_void:s},onResponseError:({response:a})=>{throw this.errorMessage=a._data.message,new Error(a._data.message)},onResponse:({response:a})=>{if(a.ok)this.successMessage=a._data.message,this.getMyApprovalRequests(),this.getOvertime(),this.getMyRequests();else throw this.errorMessage=a._data.message,new Error(a._data.message)}})}}}),x={key:0,class:"flex gap-2 p-2 justify-end relative"},G={key:1,class:"flex gap-2 p-2 justify-end relative"},Y={__name:"InfoModal",props:U({data:{type:Object,required:!0}},{showModal:{required:!1,type:Boolean}}),emits:["update:showModal"],setup(e){const s=P(e,"showModal"),a=j(),{remarks:d}=$(a),m=v(""),l=B(),o=v(!1),c=()=>{s.value=!1},w=async t=>{try{o.value=!0,await a.approveApprovalForm(t),l.add({type:"success",text:a.successMessage}),c()}catch(r){l.add({type:"error",text:r||"something went wrong."})}finally{o.value=!1}},L=async t=>{try{o.value=!0,await a.denyApprovalForm(t),l.add({type:"success",text:a.successMessage}),c()}catch(r){l.add({type:"error",text:r||"something went wrong."})}finally{o.value=!1}},k=async t=>{try{o.value=!0,await a.voidRequest(t,m.value),l.add({type:"success",text:a.successMessage}),c()}catch(r){l.add({type:"error",text:r||"something went wrong."})}finally{o.value=!1}};return(t,r)=>{const q=O,E=C,A=T,b=D;return h(),H(b,{"show-modal":s.value,"onUpdate:showModal":r[3]||(r[3]=u=>s.value=u),"is-loading":n(o),title:""},{body:y(()=>[p(q,{"overtime-data":e.data},null,8,["overtime-data"])]),footer:y(()=>{var u;return[e.data.next_approval&&("useCheckIsCurrentUser"in t?t.useCheckIsCurrentUser:n(R))((u=e.data.next_approval)==null?void 0:u.user_id)?(h(),f("div",x,[p(E,{"deny-remarks":n(d),"onUpdate:denyRemarks":r[0]||(r[0]=g=>M(d)?d.value=g:null),"request-id":e.data.id,onApprove:w,onDeny:L},null,8,["deny-remarks","request-id"])])):_("",!0),("useCheckIsCurrentUser"in t?t.useCheckIsCurrentUser:n(R))(e.data.created_by)&&e.data.request_status.toLowerCase()==="approved"&&("useCheckAccessibility"in t?t.useCheckAccessibility:n(I))([("AccessibilityTypes"in t?t.AccessibilityTypes:n(V)).HRMS_REQUEST_VOID_CREATEREQUEST])?(h(),f("div",G,[p(A,{remarks:n(m),"onUpdate:remarks":r[1]||(r[1]=g=>M(m)?m.value=g:null),"main-button-title":"Void","main-button-color":"bg-red-600","secondary-title":"Are you sure you want to void this Overtime request?","secondary-button-title":"Submit Void Request","secondary-button-color":"bg-red-600","remarks-title":"Reason for Voiding",onClick:r[2]||(r[2]=g=>k(e.data.id))},null,8,["remarks"])])):_("",!0)]}),_:1},8,["show-modal","is-loading"])}}};export{Y as _,j as u};
