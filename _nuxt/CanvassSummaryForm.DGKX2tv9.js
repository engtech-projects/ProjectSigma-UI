import re from"./Icon.DcF_NU9d.js";import{_ as me}from"./PsTable.CTJad9K5.js";import{o as n,c as m,a as e,t as d,b as E,d as pe,f as oe,q as V,r as L,L as X,x as P,y as H,u as a,A as ae,s as Y,K as ie,F as q,i as T,h as z,g as le,n as G,C as ee,G as j,_ as ne,p as de,e as ce,j as ue,ax as _e,B as fe,m as ve,v as te,D as be}from"./entry.R6V7NTxy.js";import{_ as ye}from"./PsTextInput.vue.DFQbUHfC.js";import{_ as ge}from"./PsNumberInput.vue.d-XJnO9O.js";import{u as K}from"./pricequotation.CO_uvrPh.js";import{u as he}from"./index.Cobg6QK2.js";import{_ as xe}from"./IsoHeader.vue.CeUOAvDJ.js";import{_ as we}from"./PsFormLabel.vue.MbD1f9hE.js";import{f as D}from"./Utilities.Cbr1Z9cn.js";import{_ as $e}from"./loader.C2wIXBoB.js";import{_ as Se}from"./ApprovalsList.GUTJciN1.js";import{u as ke,T as qe,A as Ce,D as Te}from"./canvassSummary.CSdjxGSl.js";import{u as Ie}from"./request.D7XiJo_f.js";import{u as Ee,l as se}from"./approvals.Db95ZdMZ.js";const Ae={class:"mt-4 p-4 bg-white rounded-md border border-gray-300"},Re={class:"flex justify-between items-center mb-4"},Le={class:"text-lg font-bold text-gray-800"},Gs={__name:"FormCreate",props:{headers:{type:Array,required:!0},datas:{type:Array,default:()=>[]},onCreate:{type:Function,required:!0},onEdit:{type:Function,required:!0},title:{type:String,required:!0},iconLabel:{type:String,required:!0}},setup(r){return(w,t)=>{const _=re,c=me;return n(),m("div",Ae,[e("div",Re,[e("h2",Le,d(r.title),1),e("button",{type:"button",class:"text-white bg-emerald-700 hover:bg-emerald-800 focus:ring-4 focus:ring-blue-300 font-semibold text-sm p-2 me-2 mb-2 flex items-center gap-1 rounded-lg",onClick:t[0]||(t[0]=(...y)=>r.onCreate&&r.onCreate(...y))},[E(_,{name:"mdi:plus",class:"h-5 w-5 text-white"}),pe(" "+d(r.iconLabel),1)])]),E(c,{"header-columns":r.headers,actions:{edit:!0},datas:r.datas,class:"rounded-md shadow-sm",onEditRow:r.onEdit},null,8,["header-columns","datas","onEditRow"])])}}},Ue={class:"border-b hover:bg-gray-50 transition"},Ve={class:"p-2 text-center"},Me={class:"p-2 text-center"},Pe={class:"p-2 text-center"},Fe={class:"p-2 text-center"},Oe={class:"p-2 text-center"},Ne={class:"p-2"},De={class:"mx-auto"},je={class:"p-2"},Be={class:"mx-auto"},Qe={class:"p-2"},Ye={class:"mx-auto"},ze=oe({__name:"ItemListEdit",props:{modelValue:{required:!0,type:Object}},emits:["update:modelValue"],setup(r){const w=K(),t=V(r,"modelValue"),_=L(!1),c=L(!1);X(t,()=>{y()},{deep:!0});const y=he(()=>{b()},500),b=async()=>{try{_.value=!0,c.value=!1,await w.updatePriceQuotationItem(t.value.id,{actual_brand:t.value.brand,unit_price:t.value.price,remarks_during_canvass:t.value.remarks})}catch{c.value=!0}finally{_.value=!1}};return(v,o)=>{const l=re,u=ye,i=ge;return n(),m("tr",Ue,[e("td",Ve,d(t.value.item_description),1),e("td",Me,d(t.value.specification),1),e("td",Pe,d(t.value.qty),1),e("td",Fe,d(t.value.unit),1),e("td",Oe,d(t.value.preferred_brand),1),e("td",Ne,[P(e("div",De,[E(l,{name:"svg-spinners:6-dots-rotate"})],512),[[H,a(_)]]),E(u,{modelValue:t.value.brand,"onUpdate:modelValue":o[0]||(o[0]=s=>t.value.brand=s),required:!0,class:"w-full",placeholder:"Enter Brand"},null,8,["modelValue"])]),e("td",je,[P(e("div",Be,[E(l,{name:"svg-spinners:6-dots-rotate"})],512),[[H,a(_)]]),E(i,{modelValue:t.value.price,"onUpdate:modelValue":o[1]||(o[1]=s=>t.value.price=s),required:!0,class:"w-full",placeholder:"Enter Price"},null,8,["modelValue"])]),e("td",Qe,[P(e("div",Ye,[E(l,{name:"svg-spinners:6-dots-rotate"})],512),[[H,a(_)]]),P(e("textarea",{"onUpdate:modelValue":o[2]||(o[2]=s=>t.value.remarks=s),placeholder:"Remarks",rows:"2",class:"w-full px-3 py-1.5 border border-slate-400 rounded-md text-sm resize-none focus:ring focus:ring-blue-200 focus:outline-none"},null,512),[[ae,t.value.remarks]])])])}}}),He={class:"text-gray-500 p-2"},Xe={class:"flex flex-col gap-4 pt-4 w-full"},Ge=e("div",{class:"basis-[10%] grow-1 shrink-0 flex items-center justify-center rounded-t mb-4"},[e("h3",{class:"pl-4 text-xl font-bold text-gray-900 p-4 tracking-wide"}," Edit Price Quotation ")],-1),Ke={class:"flex flex-col gap-4 mb-5"},Je={class:"flex flex-row justify-between gap-4"},We={class:"w-full flex flex-col gap-2"},Ze={class:"w-full"},et={class:"grid grid-cols w-full gap-y-2 mb-2 mt-1"},tt=e("label",{class:"text-sm font-medium text-gray-600"},"Quotation Date:",-1),st={class:"border p-2 rounded-md"},rt={class:"grid grid-cols w-full gap-y-2 mb-2 mt-1"},ot=e("label",{class:"text-sm font-medium text-gray-600"},"Supplier:",-1),at={class:"border p-2 rounded-md"},it={class:"grid grid-cols w-full gap-y-2 mb-2 mt-1"},lt=e("label",{class:"text-sm font-medium text-gray-600"},"Address:",-1),nt={class:"border p-2 rounded-md"},dt={class:"grid grid-cols w-full gap-y-2 mb-2 mt-1"},ct=e("label",{class:"text-sm font-medium text-gray-600"},"Contact Person:",-1),ut={class:"border p-2 rounded-md"},mt={class:"w-full flex flex-col gap-2"},pt={class:"grid grid-cols w-full gap-y-2 mb-2 mt-1"},_t=e("label",{class:"text-sm font-medium text-gray-600"},"Quotation Number:",-1),ft={class:"border p-2 rounded-md"},vt={class:"grid grid-cols w-full gap-y-2 mb-2 mt-1"},bt=e("label",{class:"text-sm font-medium text-gray-600"},"Reference No.:",-1),yt={class:"border p-2 rounded-md"},gt={class:"grid grid-cols w-full gap-y-2 mb-2 mt-1"},ht=e("label",{class:"text-sm font-medium text-gray-600"},"Contact Number:",-1),xt={class:"border p-2 rounded-md"},wt={class:"w-full"},$t={class:"overflow-x-auto rounded-lg shadow-md bg-white"},St={class:"min-w-full text-sm text-left border border-gray-200"},kt=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"p-3 border-b font-medium"}," Item Description "),e("th",{class:"p-3 border-b font-medium"}," Specification "),e("th",{class:"p-3 border-b font-medium"}," QTY "),e("th",{class:"p-3 border-b font-medium"}," UOM "),e("th",{class:"p-3 border-b font-medium"}," Preferred Brand "),e("th",{class:"p-3 border-b font-medium"}," Actual Brand "),e("th",{class:"p-3 border-b font-medium"}," Unit Price "),e("th",{class:"p-3 border-b font-medium"}," Remarks ")])],-1),qt=e("div",{class:"w-full p-4 bg-white rounded-lg"},[e("p",{class:"text-sm font-medium text-gray-900"}," Your promptness in giving us the price quotation of the above mentioned items is highly appreciated. ")],-1),Ks=oe({__name:"PriceQuotationFormEdit",setup(r){const w=K(),{editRequest:t,priceQuotation:_}=Y(w),c=L([]),y=L(!1);return ie(()=>{var b,v,o;(b=t.value.details)!=null&&b.requisition_slip&&(t.value.form.date=new Date().toISOString().split("T")[0],t.value.form.conso_reference_no=((v=t.value.details.requisition_slip)==null?void 0:v.reference_no)||"",c.value=t.value.details.requisition_slip.items||[],y.value=(o=t.value.details.requisition_slip.remarks)==null?void 0:o.toLowerCase().includes("consolidated"))}),X(()=>t.value.details,b=>{var v,o;b!=null&&b.requisition_slip&&(t.value.form.date=new Date().toISOString().split("T")[0],t.value.form.conso_reference_no=((v=t.value.details.requisition_slip)==null?void 0:v.reference_no)||"",c.value=b.requisition_slip.items||[],y.value=(o=b.requisition_slip.remarks)==null?void 0:o.toLowerCase().includes("consolidated"))},{deep:!0}),(b,v)=>{var l,u,i,s,x,g,p,$;const o=ze;return n(),m("div",He,[e("form",{onSubmit:v[0]||(v[0]=le((...C)=>b.submitForm&&b.submitForm(...C),["prevent"]))},[e("div",Xe,[Ge,e("div",Ke,[e("div",Je,[e("div",We,[e("div",Ze,[e("div",et,[tt,e("div",st,d((l=a(_).details)==null?void 0:l.quotation_date),1)]),e("div",rt,[ot,e("div",at,d((u=a(_).details)==null?void 0:u.supplier_name),1)]),e("div",it,[lt,e("div",nt,d((i=a(_).details)==null?void 0:i.supplier_address),1)]),e("div",dt,[ct,e("div",ut,d((s=a(_).details)==null?void 0:s.supplier_contact_person),1)])])]),e("div",mt,[e("div",pt,[_t,e("div",ft,d((x=a(_).details)==null?void 0:x.quotation_no),1)]),e("div",vt,[bt,e("div",yt,d((g=a(_).details)==null?void 0:g.reference_no),1)]),e("div",gt,[ht,e("div",xt,d((p=a(_).details)==null?void 0:p.supplier_contact_person_number),1)])])]),e("div",wt,[e("div",$t,[e("table",St,[kt,e("tbody",null,[(n(!0),m(q,null,T(($=a(_).details)==null?void 0:$.items,(C,f)=>(n(),z(o,{key:f+"pq-item",modelValue:a(_).details.items[f],"onUpdate:modelValue":k=>a(_).details.items[f]=k},null,8,["modelValue","onUpdate:modelValue"]))),128))])])])]),qt])])],32)])}}}),Ct={class:"w-full lg:w-1/2 border-r bg-white overflow-hidden"},Tt={class:"overflow-hidden max-h-96 lg:max-h-full"},It={class:"min-w-full table-auto text-xs sm:text-sm text-gray-800"},Et=e("thead",{class:"sticky top-0 z-10 bg-white"},[e("tr",{class:"h-20"},[e("th",{colspan:"5",class:"text-center text-lg font-bold border border-gray-700 border-r uppercase"},[e("div",{class:"flex items-center justify-center"},[e("div",{class:"text-center leading-tight"}," requested items(s) / services ")])])]),e("tr",{class:"font-semibold uppercase border border-gray-700"},[e("th",{class:"border-r border-gray-700 text-wrap w-12 text-xs"}," item no. "),e("th",{class:"border-r border-gray-700 text-xs"}," item description "),e("th",{class:"border-r border-gray-700 text-xs"}," specification "),e("th",{class:"border-r border-gray-700 w-10 text-xs"}," qty "),e("th",{class:"border-r border-gray-700 text-wrap w-12 p-1 text-xs"}," unit of measurement ")])],-1),At=["onClick"],Rt={class:"border border-gray-700 p-1 text-center font-medium text-gray-600 transition-all duration-200"},Lt={class:"border border-gray-700 p-1 font-medium transition-all duration-200 text-center"},Ut=["title"],Vt={class:"border border-gray-700 px-1 sm:px-3 py-2 sm:py-3 text-center text-gray-600 hidden md:table-cell transition-all duration-200"},Mt=["title"],Pt={class:"border border-gray-700 px-1 sm:px-3 py-2 sm:py-3 text-center font-semibold text-gray-600 transition-all duration-200"},Ft={class:"border border-gray-700 px-1 sm:px-3 py-2 sm:py-3 text-center text-gray-600 transition-all duration-200"},Ot=["title"],Nt=e("tr",null,[e("th",{colspan:"5",class:"border border-gray-700 text-center text-lg font-bold uppercase p-2"}," total amount ")],-1),Dt={__name:"RequestedItems",props:G({items:{type:Array,required:!0,default:()=>[]},suppliers:{type:Array,required:!0,default:()=>[]},readOnly:{type:Boolean,default:!1}},{selectedItems:{default:()=>({})},activeSupplier:{default:null}}),emits:["update:selectedItems","update:activeSupplier"],setup(r){const w=r,t=V(r,"selectedItems"),_=V(r,"activeSupplier"),c=ee(()=>{const l=new Map;return w.suppliers.forEach(u=>{u.items&&Array.isArray(u.items)&&u.items.forEach(i=>{i.item_id&&i.item_description&&l.set(i.item_id,{item_id:i.item_id,item_profile:{item_description:i.item_description},itemDescription:i.item_description,specification:i.specification,quantity:i.qty,uom_name:i.unit})})}),Array.from(l.values())}),y=ee(()=>w.suppliers.map(l=>({supplier_name:l.supplier_name,supplier_address:l.supplier_address,supplier_contact_person:l.supplier_contact_person,supplier_contact_number:l.supplier_contact_person_number,quotation_no:l.quotation_no,quotation_date:l.quotation_date,reference_no:l.reference_no,items:b(l.items||[],c.value)})));function b(l,u){return u.map(i=>{const s=l.find(x=>x.item_id===i.item_id);return s?{unit_price:parseFloat(s.price)||0,qty:s.qty||0,brand:s.brand,remarks:s.remarks}:null})}function v(l){var i;const u=(i=c.value[l])==null?void 0:i.item_id;u&&(t.value[u]=!t.value[u],t.value[l]=t.value[u])}function o(l){var i,s;if(_.value===null)return!1;const u=y.value[_.value];return((i=u==null?void 0:u.items)==null?void 0:i[l])!==null&&((s=u==null?void 0:u.items)==null?void 0:s[l])!==void 0}return(l,u)=>(n(),m("div",Ct,[e("div",Tt,[e("table",It,[Et,e("tbody",null,[(n(!0),m(q,null,T(a(c),(i,s)=>{var x,g;return n(),m("tr",{key:"item-"+s,class:j(["border border-gray-700 hover:bg-gray-25 cursor-pointer transition-all duration-200",[t.value[s]===!0?"bg-yellow-100 font-semibold shadow-sm":"",o(s)?"bg-green-50 border-green-200":"","bg-white"]]),onClick:p=>!r.readOnly&&v(s)},[e("td",Rt,d(s+1),1),e("td",Lt,[e("div",{class:"truncate",title:((x=i.item_profile)==null?void 0:x.item_description)||i.itemDescription},d(((g=i.item_profile)==null?void 0:g.item_description)||i.itemDescription),9,Ut)]),e("td",Vt,[e("div",{class:"truncate",title:i.specification},d(i.specification||"-"),9,Mt)]),e("td",Pt,d(i.quantity||"-"),1),e("td",Ft,[e("div",{class:"truncate",title:i.uom_name},d(i.uom_name||"-"),9,Ot)])],10,At)}),128)),Nt])])])]))}},J=r=>(de("data-v-8c2d7807"),r=r(),ce(),r),jt={class:"min-w-full table-fixed text-xs sm:text-sm text-gray-800"},Bt={class:"sticky top-0 bg-white"},Qt={class:"h-20"},Yt=["onClick"],zt={class:"flex items-center justify-center"},Ht={class:"text-center leading-tight"},Xt={class:"font-semibold uppercase border border-gray-700 h-10"},Gt=J(()=>e("th",{class:"border-r border-gray-700 text-xs py-1"}," unit price ",-1)),Kt=J(()=>e("th",{class:"border-r border-gray-700 text-xs"}," total ",-1)),Jt=J(()=>e("th",{class:"border-r border-gray-700 text-xs"}," remarks ",-1)),Wt=["title"],Zt=["title"],es=["title"],ts={class:"text-center items-center"},ss={class:"truncate text-lg"},rs={__name:"SupplierQuotes",props:G({items:{type:Array,required:!0},suppliers:{type:Array,required:!0},readOnly:{type:Boolean,default:!1}},{selectedItems:{default:()=>({})},activeSupplier:{default:null}}),emits:["update:selectedItems","update:activeSupplier"],setup(r){const w=V(r,"selectedItems"),t=V(r,"activeSupplier");function _(s){t.value===s?t.value=null:t.value=s}function c(s,x){return w.value[s]===!0&&t.value===x}const y=L(null),b=L(!1);let v=0,o=0;function l(s){b.value=!0,y.value.classList.add("cursor-grabbing"),v=s.pageX-y.value.offsetLeft,o=y.value.scrollLeft}function u(){b.value=!1,y.value.classList.remove("cursor-grabbing")}function i(s){if(!b.value)return;s.preventDefault();const x=s.pageX-y.value.offsetLeft;y.value.scrollLeft=o-(x-v)}return(s,x)=>(n(),m("div",{ref_key:"tableContainer",ref:y,class:"w-full lg:w-1/2 overflow-auto bg-white marker:overflow-auto max-h-96 lg:max-h-full scrollbar-thin cursor-grab select-none scroll-smooth",onMousedown:l,onMouseup:u,onMouseleave:u,onMousemove:i},[e("table",jt,[e("thead",Bt,[e("tr",Qt,[(n(!0),m(q,null,T(r.suppliers,(g,p)=>(n(),m("th",{key:"supplier-header-"+p,colspan:"3",class:j(["text-center font-bold border border-gray-700 border-r uppercase cursor-pointer hover:bg-green-200 transition-all duration-200 text-ellipsis w-1/2",t.value===p?"bg-green-200 shadow-inner":""]),onClick:$=>!r.readOnly&&_(p)},[e("div",zt,[e("div",Ht,[e("div",null,d(g.supplier_name),1),e("div",null,d(g.supplier_address),1),e("div",null,d(g.supplier_contact_person),1),e("div",null,d(g.supplier_contact_person_number),1)])])],10,Yt))),128))]),e("tr",Xt,[(n(!0),m(q,null,T(r.suppliers,(g,p)=>(n(),m(q,{key:"price-header-"+p},[Gt,Kt,Jt],64))),128))])]),e("tbody",null,[(n(!0),m(q,null,T(r.items,(g,p)=>(n(),m("tr",{key:"row-"+p,class:"border-b border-gray-700 hover:bg-gray-25 transition-colors duration-150"},[(n(!0),m(q,null,T(r.suppliers,($,C)=>{var f,k,I,A,R,B,F,O,N,S,h,M,U,Q,Z;return n(),m(q,{key:"cell-"+p+"-"+C},[e("td",{class:j(["border border-gray-700 p-1 text-center font-medium transition-all duration-200",[c(p,C)?"bg-yellow-100 font-bold shadow-sm":"",t.value===C&&((f=$.items)!=null&&f[p])?"bg-green-50":"","bg-white"]])},[e("div",{class:"truncate",title:("formatToCurrency"in s?s.formatToCurrency:a(D))((I=(k=$.items)==null?void 0:k[p])==null?void 0:I.price)||"-"},d(("formatToCurrency"in s?s.formatToCurrency:a(D))((R=(A=$.items)==null?void 0:A[p])==null?void 0:R.price)||"-"),9,Wt)],2),e("td",{class:j(["border border-gray-700 p-1 text-center font-semibold transition-all duration-200",[c(p,C)?"bg-yellow-100 font-bold shadow-sm":"",t.value===C&&((B=$.items)!=null&&B[p])?"bg-green-50":"","bg-white"]])},[e("div",{class:"truncate text-gray-600",title:("formatToCurrency"in s?s.formatToCurrency:a(D))((O=(F=$.items)==null?void 0:F[p])==null?void 0:O.total_amount)||"-"},d(("formatToCurrency"in s?s.formatToCurrency:a(D))((S=(N=$.items)==null?void 0:N[p])==null?void 0:S.total_amount)||"0.00"),9,Zt)],2),e("td",{class:j(["border border-gray-700 p-1 text-center transition-all duration-200",[c(p,C)?"bg-yellow-100 font-bold shadow-sm":"",t.value===C&&((h=$.items)!=null&&h[p])?"bg-green-50":"","bg-white"]]),style:{"min-width":"80px"}},[e("div",{class:"text-gray-600 w-[120px] h-[36px] overflow-auto remarks-scroll",title:((U=(M=$.items)==null?void 0:M[p])==null?void 0:U.remarks)||"-"},d(((Z=(Q=$.items)==null?void 0:Q[p])==null?void 0:Z.remarks)||"-"),9,es)],2)],64)}),128))]))),128)),e("tr",ts,[(n(!0),m(q,null,T(r.suppliers,(g,p)=>(n(),m("td",{key:"total-"+p,colspan:"3",class:"border border-t border-gray-700 p-2 text-center font-bold"},[e("div",ss," ₱"+d(("formatToCurrency"in s?s.formatToCurrency:a(D))(g.grand_total)??"0.00"),1)]))),128))])])])],544))}},os=ne(rs,[["__scopeId","data-v-8c2d7807"]]),as={class:"flex w-full"},is={key:0,class:"absolute inset-0 z-50 flex flex-col items-center justify-center bg-gray-200/60 backdrop-blur-sm rounded-lg animate-loading"},ls=e("img",{class:"w-18 h-18",src:$e,alt:"Loading..."},null,-1),ns=[ls],ds={__name:"ItemList",props:G({items:{type:Array,required:!0},suppliers:{type:Array,required:!0},loading:{type:Boolean,required:!0},readOnly:{type:Boolean,required:!0}},{selectedItems:{default:()=>({})},activeSupplier:{default:null}}),emits:["update:selectedItems","update:activeSupplier"],setup(r){const w=V(r,"selectedItems"),t=V(r,"activeSupplier");return(_,c)=>{const y=Dt,b=os;return n(),m("div",as,[r.loading?(n(),m("div",is,ns)):ue("",!0),E(y,{"selected-items":w.value,"onUpdate:selectedItems":c[0]||(c[0]=v=>w.value=v),"active-supplier":t.value,"onUpdate:activeSupplier":c[1]||(c[1]=v=>t.value=v),items:r.items,suppliers:r.suppliers,class:"w-1/2","read-only":r.readOnly},null,8,["selected-items","active-supplier","items","suppliers","read-only"]),E(b,{"selected-items":w.value,"onUpdate:selectedItems":c[2]||(c[2]=v=>w.value=v),"active-supplier":t.value,"onUpdate:activeSupplier":c[3]||(c[3]=v=>t.value=v),items:r.items,suppliers:r.suppliers,class:"w-1/2","read-only":r.readOnly},null,8,["selected-items","active-supplier","items","suppliers","read-only"])])}}},W=r=>(de("data-v-27be5481"),r=r(),ce(),r),cs={class:"text-gray-500 p-2"},us=["onSubmit"],ms={class:"flex flex-col gap-4 pt-4 w-full"},ps={key:0,class:"basis-[10%] grow-1 shrink-0 flex items-center justify-center rounded-t mb-4"},_s={class:"pl-4 text-2xl font-bold text-gray-900 p-4 uppercase"},fs={class:"flex flex-col"},vs={class:"flex flex-row justify-between gap-20"},bs={class:"w-full flex flex-col"},ys={class:"w-full flex flex-col"},gs={class:"mt-4"},hs={class:"border border-t-0 border-gray-700 shadow-sm uppercase text-black"},xs={class:"w-1/2 px-4 py-4 font-medium border-r border-gray-700 flex items-center justify-center"},ws={class:"w-1/4 px-4 py-4 flex items-center text-black"},$s=["onUpdate:modelValue"],Ss={value:"",disabled:""},ks=["value"],qs={class:"flex h-[100px]"},Cs=W(()=>e("div",{class:"w-1/2 px-4 py-4 font-medium border-r border-gray-700 flex items-center justify-center"}," Remarks ",-1)),Ts={class:"w-1/2 px-4 py-4"},Is={class:"flex w-full"},Es={class:"pt-5 w-full mb-2 rounded-lg p-4 bg-slate-100"},As=W(()=>e("label",{for:"approved_by",class:"block text-sm font-medium text-gray-900 dark:text-white"}," Approval:",-1)),Rs=W(()=>e("div",{class:"flex w-full justify-end no-print"},[e("button",{type:"submit",class:"text-white bg-emerald-700 hover:bg-emerald-800 focus:ring-4 focus:outline-none focus:ring-emerald-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center"}," Submit ")],-1)),Ls={__name:"CanvassSummaryForm",props:{title:{type:String,required:!0}},emits:["submit-success"],async setup(r,{emit:w}){let t,_;const c=ke(),y=K(),b=Ie(),v=Ee(),{createRequest:o}=Y(c),{viewRequests:l}=Y(b),{quotationsForCanvass:u}=Y(y),i=_e(),s=fe(),x=L({}),g=L(null),p=[{name:"ITEM NO.",key:"id"},{name:"ITEM DESCRIPTION",key:"itemDescription"},{name:"SPECIFICATION",key:"specification"},{name:"QTY",key:"qty"},{name:"UNIT OF MEASUREMENT",key:"unit"},...[1,2,3].flatMap(f=>[{name:"UNIT PRICE",key:`supplier${f}_unit_price`},{name:"TOTAL",key:`supplier${f}_total`},{name:"REMARKS",key:`supplier${f}_remarks`}])],$=f=>{f&&(o.value.form.date=new Date().toISOString().split("T")[0],o.value.form.project_code=f.office_project,o.value.form.project_address=f.office_project_address,o.value.form.conso_reference_no=f.reference_no)},C=async()=>{var f,k;try{const I=(((k=(f=l.value.details)==null?void 0:f.requisition_slip)==null?void 0:k.request_stock_items)||[]).filter(R=>x.value[R.item_id]===!0).map(R=>({item_id:R.item_id}));if(!I.length)throw new Error("Please select at least one item.");if(g.value===null)throw new Error("Please select a supplier before submitting.");const A=u.value.list[g.value];if(!A||!A.id)throw new Error("Invalid supplier selection. Please try again.");o.value.form.items=I,o.value.form.price_quotation_id=A.id,o.value.form.approvals=await v.getApprovalByName(se),await c.storeRequest(),s.add({type:"success",text:c.createRequest.successMessage}),w("submit-success")}catch(I){s.add({type:"error",text:(I==null?void 0:I.message)||c.createRequest.errorMessage||"An unexpected error occurred."})}};return o.value.approvals=([t,_]=ve(()=>v.getApprovalByName(se)),t=await t,_(),t),ie(()=>{var f;c.resetForm(),b.getOne(i.query.pr_id),y.getQuotationsForCanvass(i.query.pr_id),$((f=l.value.details)==null?void 0:f.requisition_slip)}),X(()=>{var f;return(f=l.value.details)==null?void 0:f.requisition_slip},f=>$(f),{deep:!0}),(f,k)=>{var F,O,N;const I=xe,A=we,R=ds,B=Se;return n(),m("div",cs,[e("form",{onSubmit:le(C,["prevent"])},[e("div",ms,[E(I,{page:{currentPage:1,totalPages:1}}),r.title?(n(),m("div",ps,[e("h3",_s,d(r.title),1)])):ue("",!0),e("div",fs,[e("div",vs,[e("div",bs,[(n(!0),m(q,null,T({DATE:a(o).form.date,"PROJECT CODE":a(o).form.project_code,"CONSO/RS REFERENCE NUMBER":a(o).form.conso_reference_no},(S,h)=>(n(),z(A,{key:h,title:h,value:S},null,8,["title","value"]))),128))]),e("div",ys,[(n(!0),m(q,null,T({"CS NUMBER":a(o).form.cs_number||"Generated after submission"},(S,h)=>(n(),z(A,{key:h,title:h,value:S},null,8,["title","value"]))),128))])]),e("div",gs,[E(R,{"selected-items":a(x),"onUpdate:selectedItems":k[0]||(k[0]=S=>te(x)?x.value=S:null),"active-supplier":a(g),"onUpdate:activeSupplier":k[1]||(k[1]=S=>te(g)?g.value=S:null),items:(N=(O=(F=a(l))==null?void 0:F.details)==null?void 0:O.requisition_slip)==null?void 0:N.request_stock_items,suppliers:a(u).list,columns:p,loading:a(u).isLoading||a(l).isLoading,"read-only":!1},null,8,["selected-items","active-supplier","items","suppliers","loading"]),e("div",hs,[(n(!0),m(q,null,T({"Terms and Conditions":a(qe),Availability:a(Ce),"Delivery Terms":a(Te)},(S,h,M)=>(n(),m("div",{key:M,class:"flex h-[60px] border-b border-gray-700 last:border-b-0"},[e("div",xs,d(h),1),e("div",ws,[P(e("select",{"onUpdate:modelValue":U=>a(o).form[h==="Terms and Conditions"?"terms_of_payment":h.replace(/ /g,"_").toLowerCase()]=U,class:"w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-500"},[e("option",Ss," Select "+d(h)+"... ",1),(n(!0),m(q,null,T(S,(U,Q)=>(n(),m("option",{key:Q,value:U},d(U),9,ks))),128))],8,$s),[[be,a(o).form[h==="Terms and Conditions"?"terms_of_payment":h.replace(/ /g,"_").toLowerCase()]]])])]))),128)),e("div",qs,[Cs,e("div",Ts,[P(e("textarea",{"onUpdate:modelValue":k[2]||(k[2]=S=>a(o).form.remarks=S),class:"w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 resize-none",rows:"2",placeholder:"Enter remarks..."},null,512),[[ae,a(o).form.remarks]])])])])]),e("div",Is,[e("div",Es,[As,(n(!0),m(q,null,T(a(o).approvals,(S,h)=>(n(),z(B,{key:"hrmsetupapprovallist"+S,modelValue:a(o).approvals[h],"onUpdate:modelValue":M=>a(o).approvals[h]=M},null,8,["modelValue","onUpdate:modelValue"]))),128))])]),Rs])])],40,us)])}}},Js=ne(Ls,[["__scopeId","data-v-27be5481"]]);export{Gs as _,ds as a,Ks as b,Js as c};
