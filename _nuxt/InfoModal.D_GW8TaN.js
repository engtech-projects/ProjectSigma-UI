import{_ as O}from"./RequestDetails._YzPrvTX.js";import{_ as D}from"./LayoutPrint.BjcxelaN.js";import{_ as S}from"./ApprovalDenyButton.2aaI0auR.js";import{_ as U}from"./PsHoverButton.B5SrmACV.js";import{_ as V}from"./PsModal.Bk3xu63Y.js";import{l as B,n as F,q as I,s as P,r as y,B as $,o as g,h as H,w as f,b as p,u as i,c as _,v as R,j as L}from"./entry.32UGFqj-.js";import{a as w,u as j,A as x}from"./Accessibilities.xGffDRXj.js";import{b as l,c as v}from"./CustomFetch.ggXvTdIz.js";const G=B("travels",{state:()=>({createRequestData:{isLoading:!1,errorMessage:"",successMessage:"",body:{id:null,name:"",employee_ids:[],requesting_office:null,destination:null,purpose_of_travel:"",date_of_travel:null,time_of_travel:null,duration_of_travel:null,means_of_transportation:null,remarks:"",charge_type:null,project_id:null,department_id:null,approvals:[],request_status:""}},allList:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{},errorMessage:"",successMessage:""},approvalList:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{},errorMessage:"",successMessage:""},myRequestList:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{},errorMessage:"",successMessage:""},successMessage:"",remarks:""}),actions:{async getOne(e){return await l("/api/travelorder-request/resource/"+e,{method:"GET",onResponse:({response:s})=>{if(s.ok)return s._data.data;throw new Error(s._data.message)}})},async getTravelorders(){await v("/api/travelorder-request/resource",{method:"GET",params:this.allList.params,watch:!1,onRequest:()=>{this.allList.isLoading=!0,this.allList.list=[]},onResponseError:({response:e})=>{throw new Error(e._data.message)},onResponse:({response:e})=>{this.allList.isLoading=!1,e.ok&&(this.allList.isLoaded=!0,this.allList.list=e._data.data,this.allList.pagination={first_page:e._data.links.first,pages:e._data.meta.links,last_page:e._data.links.last})}})},async getMyRequests(){await v("/api/travelorder-request/my-request",{method:"GET",params:this.myRequestList.params,watch:!1,onRequest:()=>{this.myRequestList.isLoading=!0,this.myRequestList.list=[]},onResponseError:({response:e})=>{throw new Error(e._data.message)},onResponse:({response:e})=>{this.myRequestList.isLoading=!1,e.ok&&(this.myRequestList.isLoaded=!0,this.myRequestList.list=e._data.data,this.myRequestList.pagination={first_page:e._data.links.first,pages:e._data.meta.links,last_page:e._data.links.last})}})},async getMyApprovalRequests(){await v("/api/travelorder-request/my-approvals",{method:"GET",params:this.approvalList.params,watch:!1,onRequest:()=>{this.approvalList.isLoading=!0,this.approvalList.list=[]},onResponseError:({response:e})=>{throw new Error(e._data.message)},onResponse:({response:e})=>{this.approvalList.isLoading=!1,e.ok&&(this.approvalList.isLoaded=!0,this.approvalList.list=e._data.data,this.approvalList.pagination={first_page:e._data.links.first,pages:e._data.meta.links,last_page:e._data.links.last})}})},async createRequest(){this.createRequestData.isLoading||await l("/api/travelorder-request/resource",{method:"POST",body:this.createRequestData.body,onRequest:()=>{this.createRequestData.isLoading=!0},onResponseError:({response:e})=>{throw this.createRequestData.isLoading=!1,new Error(e._data.message)},onResponse:({response:e})=>{this.createRequestData.isLoading=!1,e.ok&&(this.reloadResources(),this.createRequestData.successMessage=e._data.message)}})},async approveApprovalForm(e){await l("/api/approvals/approve/TravelOrder/"+e,{method:"POST",onResponseError:({response:s})=>{throw new Error(s._data.message)},onResponse:({response:s})=>{if(s.ok)return this.reloadResources(),this.successMessage=s._data.message,s._data}})},async denyApprovalForm(e){const s=new FormData;s.append("id",e),s.append("remarks",this.remarks),await l("/api/approvals/disapprove/TravelOrder/"+e,{method:"POST",body:s,onResponseError:({response:a})=>{throw new Error(a._data.message)},onResponse:({response:a})=>{if(a.ok)return this.reloadResources(),this.successMessage=a._data.message,a._data}})},async voidRequest(e,s){await l("/api/request-voids/void/TravelOrder/"+e,{method:"POST",params:{reason_for_void:s},onResponseError:({response:a})=>{throw new Error(a._data.message)},onResponse:({response:a})=>{a.ok&&(this.reloadResources(),this.successMessage=a._data.message)}})},reloadResources(){const e=[];this.allList.isLoaded&&e.push(this.getTravelorders),this.approvalList.isLoaded&&e.push(this.getMyApprovalRequests),this.myRequestList.isLoaded&&e.push(this.getMyRequests),this.$reset(),e.forEach(s=>{s()})}}}),N={key:0,class:"flex gap-2 p-2 justify-end relative"},Q={key:1,class:"flex gap-2 p-2 justify-end relative"},se={__name:"InfoModal",props:F({data:{type:Object,required:!0}},{showModal:{required:!1,type:Boolean}}),emits:["update:showModal"],setup(e){const s=I(e,"showModal"),a=G(),{remarks:m}=P(a),d=y(""),n=$(),o=y(!1),h=()=>{s.value=!1},q=async t=>{try{o.value=!0,await a.approveApprovalForm(t),n.add({type:"success",text:a.successMessage}),h()}catch(r){n.add({type:"error",text:r||"something went wrong."})}finally{o.value=!1}},k=async t=>{try{o.value=!0,await a.denyApprovalForm(t),n.add({type:"success",text:a.successMessage}),h()}catch(r){n.add({type:"error",text:r||"something went wrong."})}finally{o.value=!1}},M=async t=>{try{o.value=!0,await a.voidRequest(t,d.value),n.add({type:"success",text:a.successMessage}),h()}catch(r){n.add({type:"error",text:r||"something went wrong."})}finally{o.value=!1}};return(t,r)=>{const E=O,b=D,T=S,A=U,C=V;return g(),H(C,{"show-modal":s.value,"onUpdate:showModal":r[3]||(r[3]=u=>s.value=u),"is-loading":i(o),title:"TRAVEL ORDER"},{body:f(()=>[p(b,null,{default:f(()=>[p(E,{"travel-order-data":e.data},null,8,["travel-order-data"])]),_:1})]),footer:f(()=>{var u;return[e.data.next_approval&&("useCheckIsCurrentUser"in t?t.useCheckIsCurrentUser:i(w))((u=e.data.next_approval)==null?void 0:u.user_id)?(g(),_("div",N,[p(T,{"deny-remarks":i(m),"onUpdate:denyRemarks":r[0]||(r[0]=c=>R(m)?m.value=c:null),"request-id":e.data.id,onApprove:q,onDeny:k},null,8,["deny-remarks","request-id"])])):L("",!0),("useCheckIsCurrentUser"in t?t.useCheckIsCurrentUser:i(w))(e.data.created_by)&&e.data.request_status.toLowerCase()==="approved"&&("useCheckAccessibility"in t?t.useCheckAccessibility:i(j))([("AccessibilityTypes"in t?t.AccessibilityTypes:i(x)).HRMS_REQUEST_VOID_CREATEREQUEST])?(g(),_("div",Q,[p(A,{remarks:i(d),"onUpdate:remarks":r[1]||(r[1]=c=>R(d)?d.value=c:null),"main-button-title":"Void","main-button-color":"bg-red-600","secondary-title":"Are you sure you want to void this Travel Order request?","secondary-button-title":"Submit Void Request","secondary-button-color":"bg-red-600","remarks-title":"Reason for Voiding",onClick:r[2]||(r[2]=c=>M(e.data.id))},null,8,["remarks"])])):L("",!0)]}),_:1},8,["show-modal","is-loading"])}}};export{se as _,G as u};
