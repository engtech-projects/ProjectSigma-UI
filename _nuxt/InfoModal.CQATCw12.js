import{_ as x}from"./ListView.CUwkSJ9r.js";import{_ as k}from"./ApprovalDenyButton.2aaI0auR.js";import{_ as A}from"./PsModal.Bk3xu63Y.js";import{l as E,n as T,q as D,s as b,B as F,r as C,o as _,h as O,w as f,a as s,d as i,t as l,b as y,u as m,c as I,v as j,j as P}from"./entry.32UGFqj-.js";import{a as S}from"./Accessibilities.xGffDRXj.js";import{b as c,c as p}from"./CustomFetch.ggXvTdIz.js";const B="In",U="Out",fa=[B,U],G=E("Failtologs",{state:()=>({isEdit:!1,createRequestData:{isLoading:!1,data:{id:null,employee_id:null,date:"",time:"",log_type:null,reason:null,charging_type:null,project_id:null,department_id:null,approvals:[]},successMessage:"",errorMessage:""},failtolog:{id:null,employee_id:null,date:"",time:"",log_type:null,reason:null,charging_type:null,project_id:null,department_id:null,approvals:[]},errorMessage:"",successMessage:"",remarks:"",allRequests:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{}},myApprovals:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{}},myRequests:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{}}}),actions:{async getOne(a){return await c("/api/attendance/failed-log/"+a,{method:"GET",onResponse:({response:e})=>{if(e.ok)return e._data.data;throw new Error(e._data.message)}})},async getAllList(){this.allRequests.isLoaded=!0,await p("/api/attendance/failed-log",{method:"GET",params:this.allRequests.params,onRequest:()=>{this.allRequests.isLoading=!0},onResponse:({response:a})=>{this.allRequests.isLoading=!1,a.ok&&(this.allRequests.list=a._data.data,this.allRequests.pagination={first_page:a._data.links.first,pages:a._data.meta.links,last_page:a._data.links.last})}})},async getMyRequests(){this.myRequests.isLoaded=!0,await p("/api/attendance/failure-to-log/my-requests",{method:"GET",params:this.myRequests.params,onRequest:()=>{this.myApprovals.isLoading=!0},onResponse:({response:a})=>{if(this.myRequests.isLoading=!1,a.ok)this.myRequests.list=a._data.data,this.myRequests.pagination={first_page:a._data.links.first,pages:a._data.meta.links,last_page:a._data.links.last};else throw this.errorMessage=a._data.message,new Error(a._data.message)}})},async getMyApprovalRequests(){this.myApprovals.isLoaded=!0,await p("/api/attendance/failure-to-log/my-approvals",{method:"GET",params:this.myApprovals.params,onRequest:()=>{this.myApprovals.isLoading=!0},onResponse:({response:a})=>{if(this.myApprovals.isLoading=!1,a.ok)this.myApprovals.list=a._data.data,this.myApprovals.pagination={first_page:a._data.links.first,pages:a._data.meta.links,last_page:a._data.links.last};else throw this.errorMessage=a._data.message,new Error(a._data.message)}})},async createLog(){this.createRequestData.isLoading||(this.successMessage="",this.errorMessage="",await c("/api/attendance/failed-log",{method:"POST",body:this.createRequestData.data,onRequest:()=>{this.createRequestData.isLoading=!0},onResponse:({response:a})=>{if(this.createRequestData.isLoading=!1,a.ok)this.reloadResources(),this.createRequestData.successMessage=a._data.message;else throw this.createRequestData.errorMessage=a._data.message,new Error(a._data.message)}}))},clearMessages(){this.errorMessage="",this.successMessage=""},async editLog(){this.successMessage="",this.errorMessage="",await c("/api/attendance/failed-log/"+this.failtolog.id,{method:"PATCH",body:this.failtolog,onResponse:({response:a})=>{a.ok?(this.reloadResources(),this.successMessage=a._data.message):this.errorMessage=a._data.message}})},async deleteLog(a){const{data:e,error:t}=await p("/api/attendance/failed-log/"+a,{method:"DELETE",watch:!1,onResponse:({response:r})=>{r.ok&&(this.reloadResources(),this.successMessage=r._data.message)}});if(t.value)throw this.errorMessage=t.value.data.message,new Error(this.errorMessage);if(e.value)return this.getAllList(),e},async approveApprovalForm(a){this.successMessage="",this.errorMessage="",await c("/api/approvals/approve/FailureToLog/"+a,{method:"POST",onResponseError:({response:e})=>{throw this.errorMessage=e._data.message,new Error(e._data.message)},onResponse:({response:e})=>{if(e.ok)return this.reloadResources(),this.successMessage=e._data.message,e._data;throw this.errorMessage=e._data.message,new Error(e._data.message)}})},async denyApprovalForm(a){this.successMessage="",this.errorMessage="";const e=new FormData;e.append("id",a),e.append("remarks",this.remarks),await c("/api/approvals/disapprove/FailureToLog/"+a,{method:"POST",body:e,onResponseError:({response:t})=>{throw this.errorMessage=t._data.message,new Error(t._data.message)},onResponse:({response:t})=>{if(t.ok)return this.reloadResources(),this.successMessage=t._data.message,t._data}})},reloadResources(){const a=this.createRequestData.data.approvals,e=[];this.allRequests.isLoaded&&e.push(this.getAllList),this.myRequests.isLoaded&&e.push(this.getMyRequests),this.myApprovals.isLoaded&&e.push(this.getMyApprovalRequests),this.$reset(),this.createRequestData.data.approvals=a,e.forEach(t=>{t()})}}}),N=s("div",{class:"grid gap-2 md:justify-between"},[s("div",{class:"p-2 flex gap-2"},[s("span",{class:"text-gray-900 text-4xl"},"Failure to Log")])],-1),V={class:"grid md:grid-cols-3 gap-2 md:justify-between"},H={class:"p-2 flex gap-2"},$=s("span",{class:"text-teal-600 text-light font-medium"},"Employee Name: ",-1),Y={class:"text-gray-900"},z={class:"p-2 flex gap-2"},J=s("span",{class:"text-teal-600 text-light font-medium"}," Date: ",-1),K={class:"text-gray-900"},Q={class:"p-2 flex gap-2"},W=s("span",{class:"text-teal-600 text-light font-medium"},"Time: ",-1),X={class:"p-2 flex gap-2"},Z=s("span",{class:"text-teal-600 text-light font-medium"},"Log Type: ",-1),aa={class:"p-2 flex gap-2"},ea=s("span",{class:"text-teal-600 text-light font-medium"},"Reason: ",-1),sa={class:"p-2 flex gap-2"},ta=s("span",{class:"text-teal-600 text-light font-medium"},"Charging Designation: ",-1),oa={class:"grid md:grid-cols-3 gap-2 md:justify-between"},ia={class:"p-2 flex gap-2"},la=s("span",{class:"text-teal-600 text-light font-medium"}," Prepared by: ",-1),ra={class:"p-2 flex gap-2"},da=s("span",{class:"text-teal-600 text-light font-medium"}," Prepared on: ",-1),na={class:"w-full"},ca={key:0,class:"flex gap-2 p-2 justify-end"},ya={__name:"InfoModal",props:T({data:{type:Object,required:!0}},{showModal:{required:!1,type:Boolean}}),emits:["update:showModal"],setup(a){const e=D(a,"showModal"),t=G(),{remarks:r}=b(t),g=F(),n=C(!1),h=()=>{e.value=!1},v=async d=>{try{n.value=!0,await t.approveApprovalForm(d),g.add({type:"success",text:t.successMessage}),h()}catch(o){g.add({type:"error",text:o||"something went wrong."})}finally{n.value=!1}},R=async d=>{try{n.value=!0,await t.denyApprovalForm(d),g.add({type:"success",text:t.successMessage}),h()}catch(o){g.add({type:"error",text:o||"something went wrong."})}finally{n.value=!1}};return(d,o)=>{const M=x,w=k,L=A;return _(),O(L,{"show-modal":e.value,"onUpdate:showModal":o[1]||(o[1]=u=>e.value=u),"is-loading":m(n),title:"FAILURE TO LOG"},{body:f(()=>[N,s("div",V,[s("div",H,[$,i(),s("span",Y,l(a.data.employee.fullname_first),1)]),s("div",z,[J,i(),s("span",K,l(a.data.date_human),1)]),s("div",Q,[W,i(" "+l(a.data.time_human),1)]),s("div",X,[Z,i(" "+l(a.data.log_type),1)]),s("div",aa,[ea,i(" "+l(a.data.reason),1)]),s("div",sa,[ta,i(" "+l(a.data.charging_designation),1)])]),s("div",oa,[s("div",ia,[la,i(" "+l(a.data.created_by_user),1)]),s("div",ra,[da,i(" "+l(a.data.created_at_human),1)])]),s("div",na,[y(M,{approvals:a.data.approvals},null,8,["approvals"])])]),footer:f(()=>{var u;return[a.data.next_approval&&("useCheckIsCurrentUser"in d?d.useCheckIsCurrentUser:m(S))((u=a.data.next_approval)==null?void 0:u.user_id)?(_(),I("div",ca,[y(w,{"deny-remarks":m(r),"onUpdate:denyRemarks":o[0]||(o[0]=q=>j(r)?r.value=q:null),"request-id":a.data.id,onApprove:v,onDeny:R},null,8,["deny-remarks","request-id"])])):P("",!0)]}),_:1},8,["show-modal","is-loading"])}}};export{fa as L,ya as _,G as u};
