import{_ as F}from"./ListView.DgUPeMcI.js";import{_ as S}from"./ApprovalDenyButton.B1ShEyLo.js";import j from"./Icon.DcF_NU9d.js";import{l as O,f as C,s as N,B,r as k,u as l,o as n,c as r,a as e,b as y,v as H,j as x,d as L,F as $,i as G,t as f,x as I,A as V,n as U,q as Y,h as K,w as W}from"./entry.R6V7NTxy.js";import{j as z,d as v}from"./Utilities.Cbr1Z9cn.js";import{a as J}from"./Accessibilities.uaboihcy.js";import{b as h,c as p}from"./CustomFetch.BRBLzGci.js";import{_ as Q}from"./PsModal.DW9SixU3.js";const X="weekly",Z="monthly",aa="bimonthly",ge=[Z,aa,X],ea=O("Cashadvances",{state:()=>({createData:{isLoading:!1,errorMessage:"",successMessage:"",params:{}},isEdit:!1,cashadvance:{id:null,employee_id:null,department_id:null,project_id:null,terms_of_payment:null,installment_deduction:null,deduction_date_start:"",amount:null,purpose:null,remarks:"",request_status:"",approvals:[],cash_advance_payments:[]},newPayment:{id:null,cashadvance_id:null,amount_paid:null,date_paid:z(new Date),payment_type:"Manual",posting_status:"Posted",paymentAmount:null},ca:[],cashAdvanceList:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{}},myApprovalRequestList:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{}},myRequestList:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{}},paidCashAdvanceList:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{}},ongoingCashAdvanceList:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{}},paymentCashAdvanceList:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{}},paymentData:{cashadvance_id:null,data:{paymentAmount:0},successMessage:"",errorMessage:""},pagination:{},getParams:{},errorMessage:"",successMessage:"",remarks:""}),actions:{async getOne(a){return await h("/api/cash-advance/resource/"+a,{method:"GET",params:this.getParams,onResponse:({response:s})=>{if(s.ok)return s._data.data;throw new Error(s._data.message)}})},async getCA(){this.cashAdvanceList.isLoaded=!0,await p("/api/cash-advance/resource",{method:"GET",params:this.cashAdvanceList.params,watch:!1,onRequest:()=>{this.cashAdvanceList.isLoading=!0},onResponse:({response:a})=>{this.cashAdvanceList.isLoading=!1,a.ok&&(this.cashAdvanceList.list=a._data.data,this.cashAdvanceList.pagination={first_page:a._data.links.first,pages:a._data.meta.links,last_page:a._data.links.last})}})},async getMyRequests(){this.myRequestList.isLoaded=!0,await p("/api/cash-advance/my-request",{method:"GET",params:this.getParams,watch:!1,onRequest:()=>{this.myRequestList.isLoading=!0},onResponse:({response:a})=>{this.myRequestList.isLoading=!1,a.ok&&(this.myRequestList.list=a._data.data,this.pagination={first_page:a._data.links.first,pages:a._data.meta.links,last_page:a._data.links.last})}})},async getOngoingCashAdvance(){await p("/api/cash-advance/ongoing",{method:"GET",params:this.getParams,watch:!1,onRequest:()=>{this.ongoingCashAdvanceList.isLoading=!0},onResponse:({response:a})=>{this.ongoingCashAdvanceList.isLoading=!1,a.ok&&(this.ongoingCashAdvanceList.list=a._data.data,this.ongoingCashAdvanceList.isLoaded=!0,this.pagination={first_page:a._data.links.first,pages:a._data.meta.links,last_page:a._data.links.last})}})},async getPaidCashAdvance(){await p("/api/cash-advance/paid",{method:"GET",params:this.getParams,watch:!1,onRequest:()=>{this.paidCashAdvanceList.isLoading=!0},onResponse:({response:a})=>{this.paidCashAdvanceList.isLoading=!1,a.ok&&(this.paidCashAdvanceList.list=a._data.data,this.paidCashAdvanceList.isLoaded=!0,this.pagination={first_page:a._data.links.first,pages:a._data.meta.links,last_page:a._data.links.last})}})},async getMyApprovalRequests(){this.myApprovalRequestList.isLoaded=!0,await p("/api/cash-advance/my-approvals",{method:"GET",params:this.getParams,watch:!1,onRequest:()=>{this.myApprovalRequestList.isLoading=!0},onResponse:({response:a})=>{this.myApprovalRequestList.isLoading=!1,a.ok&&(this.myApprovalRequestList.list=a._data.data,this.pagination={first_page:a._data.links.first,pages:a._data.meta.links,last_page:a._data.links.last})}})},async getPaymentsCashAdvance(){await p("/api/cash-advance/payments",{method:"GET",params:this.getParams,watch:!1,onRequest:()=>{this.paymentCashAdvanceList.isLoading=!0},onResponse:({response:a})=>{this.paymentCashAdvanceList.isLoading=!1,a.ok&&(this.paymentCashAdvanceList.list=a._data.data,this.paymentCashAdvanceList.isLoaded=!0,this.pagination={first_page:a._data.links.first,pages:a._data.meta.links,last_page:a._data.links.last})}})},async createRequest(){if(this.createData.isLoading)return;const a=this.cashadvance.employee_id,s=this.cashadvance.approvals;await h("/api/cash-advance/resource",{method:"POST",body:this.cashadvance,onRequest:()=>{this.createData.isLoading=!0},onResponseError:({response:t})=>{throw this.createData.isLoading=!1,this.errorMessage=t._data.message,new Error(t._data.message)},onResponse:({response:t})=>{this.createData.isLoading=!1,t.ok?(this.reloadResources(),this.successMessage=t._data.message,this.cashadvance.employee_id=a,this.cashadvance.approvals=s):this.errorMessage=t._data.message}})},async editRequest(){this.successMessage="",this.errorMessage="",await h("/api/cash-advance/resource/"+this.cashadvance.id,{method:"PATCH",body:this.cashadvance,onResponse:({response:a})=>{a.ok?(this.reloadResources(),this.successMessage=a._data.message):this.errorMessage=a._data.message}})},async deleteRequest(a){return await h("/api/cash-advance/resource/"+a,{method:"DELETE",watch:!1,onResponse:({response:s})=>s.ok?(this.reloadResources(),this.successMessage=s._data.message,s._data.message):(this.errorMessage=s._data.message,s._data.message)})},async approveApprovalForm(a){this.successMessage="",this.errorMessage="",await h("/api/approvals/approve/CashAdvance/"+a,{method:"POST",onResponseError:({response:s})=>{throw this.errorMessage=s._data.message,new Error(s._data.message)},onResponse:({response:s})=>{if(s.ok)return this.reloadResources(),this.successMessage=s._data.message,s._data;throw this.errorMessage=s._data.message,new Error(s._data.message)}})},async denyApprovalForm(a){this.successMessage="",this.errorMessage="";const s=new FormData;s.append("id",a),s.append("remarks",this.remarks),await h("/api/approvals/disapprove/CashAdvance/"+a,{method:"POST",body:s,onResponseError:({response:t})=>{throw this.errorMessage=t._data.message,new Error(t._data.message)},onResponse:({response:t})=>{if(t.ok)return this.successMessage=t._data.message,this.getMyApprovalRequests(),t._data}})},async submitPayment(a){return await h("/api/cash-advance/manual-payment/"+a,{method:"POST",body:this.paymentData.data,onResponseError:({response:s})=>{throw new Error(s._data.message)},onResponse:({response:s})=>{if(s.ok)return this.reloadResources(),this.paymentData.successMessage=s._data.message,s._data.data;throw new Error(s._data.message)}})},reloadResources(){const a=[];this.cashAdvanceList.isLoaded&&a.push(this.getCA),this.myRequestList.isLoaded&&a.push(this.getMyRequests),this.myApprovalRequestList.isLoaded&&a.push(this.getMyApprovalRequests),this.ongoingCashAdvanceList.isLoaded&&a.push(this.getOngoingCashAdvance),this.paidCashAdvanceList.isLoaded&&a.push(this.getPaidCashAdvance),this.paymentCashAdvanceList.isLoaded&&a.push(this.getPaymentsCashAdvance),this.$reset(),a.forEach(s=>{s()})}}}),sa={key:0,class:"flex flex-col gap-2"},ta={class:"flex gap-4"},oa={class:"flex flex-1 flex-col gap-1"},ia=e("label",{class:"font-semibold text-gray-700"},"Employee Name: ",-1),da=["value"],na={class:"flex flex-1 flex-col gap-1"},la=e("label",{class:"font-semibold text-gray-700"},"Project: ",-1),ra=["value"],ca={class:"flex flex-1 flex-col gap-1"},ua=e("label",{class:"font-semibold text-gray-700"},"Department: ",-1),ha=["value"],ma={class:"flex gap-4"},ga={class:"flex flex-1 flex-col gap-1"},pa=e("label",{class:"font-semibold text-gray-700"},"Cash Advance Amount: ",-1),ya=["value"],_a={class:"flex flex-1 flex-col gap-1"},fa=e("label",{class:"font-semibold text-gray-700"},"Terms: ",-1),va=["value"],ba={class:"flex flex-1 flex-col gap-1"},xa=e("label",{class:"font-semibold text-gray-700"},"Purpose/Reason(s): ",-1),La=["value"],Aa={class:"flex gap-4"},wa={class:"flex flex-1 flex-col gap-1"},ka=e("label",{class:"font-semibold text-gray-700"},"Installment Deduction: ",-1),Ca=["value"],Ra={class:"flex flex-1 flex-col gap-1"},Ma=e("label",{class:"font-semibold text-gray-700"},"Deduction Date start: ",-1),qa=["value"],Pa={class:"flex flex-1 flex-col gap-1"},Ea=e("label",{class:"font-semibold text-gray-700"},"Balance: ",-1),Da=["value"],Ta={class:"flex gap-4"},Fa={class:"flex flex-1 flex-col gap-1"},Sa=e("label",{class:"font-semibold text-gray-700"},"Prepared by: ",-1),ja=["value"],Oa={class:"flex flex-1 flex-col gap-1"},Na=e("label",{class:"font-semibold text-gray-700"},"Prepared on: ",-1),Ba=["value"],Ha={class:"w-full"},$a={key:0,class:"flex gap-2 p-2 justify-end"},Ga={key:1,class:"flex flex-col mt-6"},Ia={class:"flex items-center justify-between border-b pb-2"},Va=e("label",{for:"",class:"text-md text-slate-700 font-bold"},"Payment History",-1),Ua={key:0,class:"table w-full text-left mt-4 border"},Ya=e("thead",{class:"border-b"},[e("th",{class:"py-2"}," Amount Paid "),e("th",{class:"py-2"}," Date Paid "),e("th",{class:"py-2"}," Payment Type "),e("th",{class:"py-2"}," Posting Status ")],-1),Ka={class:"px-2 py-1 text-slate-600"},Wa={class:"px-2 py-1 text-slate-600"},za={class:"px-2 py-1 text-slate-600"},Ja={class:"px-2 py-1 text-slate-600"},Qa={key:1,class:"w-full py-4 flex justify-center bg-slate-100 items-center"},Xa=e("span",null,"No payments yet.",-1),Za=[Xa],ae={key:1},ee={class:"flex gap-4 mb-2"},se={class:"flex flex-1 flex-col gap-1"},te=e("label",{for:"",class:"text-gray-500 text-sm"},"Payment Amount",-1),oe={class:"flex flex-1 flex-col gap-1"},ie=C({__name:"CashadvanceDetails",props:{data:{type:Object,required:!0}},emits:["closeModal"],setup(a,{emit:s}){const t=a,u=ea(),{remarks:m,paymentData:g}=N(u),c=B(),_=k(!1),A=k(!1),R=async()=>{try{await u.submitPayment(t.data.id),c.add({type:"success",text:g.value.successMessage}),s("closeModal")}catch(o){c.add({type:"error",text:o})}},M=async o=>{try{await u.approveApprovalForm(o),c.add({type:"success",text:u.successMessage})}catch(i){c.add({type:"error",text:i||"something went wrong."})}finally{A.value=!1}},q=async o=>{try{await u.denyApprovalForm(o),c.add({type:"success",text:u.successMessage})}catch(i){c.add({type:"error",text:i||"something went wrong."})}finally{A.value=!1}},P=()=>{g.value.data.paymentAmount=0,_.value=!1},E=()=>{_.value=!0};return(o,i)=>{var w;const D=F,T=S,b=j;return l(_)?(n(),r("div",ae,[e("div",ee,[e("div",se,[te,I(e("input",{"onUpdate:modelValue":i[2]||(i[2]=d=>l(g).data.paymentAmount=d),type:"number",class:"border border-gray-200 bg-white rounded-md",placeholder:"0.00",required:""},null,512),[[V,l(g).data.paymentAmount]])]),e("div",oe,[e("button",{class:"bg-gray-100 rounded-md px-4 py-1 text-gray-800 hover:bg-gray-200 active:bg-gray-300",onClick:i[3]||(i[3]=d=>P())},[y(b,{name:"mingcute:minus-circle-line",class:"font-bold text-md text-gray-600 mb-1"}),L(" Cancel ")]),e("button",{class:"bg-green-500 rounded-md px-8 py-1 text-white hover:bg-green-600 active:bg-green-700",onClick:i[4]||(i[4]=d=>R())},[y(b,{name:"iconoir:hand-card",class:"font-bold text-xl"}),L(" Pay ")])])])])):(n(),r("div",sa,[e("div",ta,[e("div",oa,[ia,e("input",{type:"text",class:"border border-gray-200 bg-gray-100 rounded-md",value:a.data.employee.fullname_first||"",disabled:""},null,8,da)]),e("div",na,[la,e("input",{type:"text",class:"border border-gray-200 bg-gray-100 rounded-md",value:a.data.project?a.data.project.project_code:"N/A",disabled:""},null,8,ra)]),e("div",ca,[ua,e("input",{type:"text",class:"border border-gray-200 bg-gray-100 rounded-md",value:a.data.department?a.data.department.department_name:"N/A",disabled:""},null,8,ha)])]),e("div",ma,[e("div",ga,[pa,e("input",{type:"text",class:"border border-gray-200 bg-gray-100 rounded-md",value:("useFormatCurrency"in o?o.useFormatCurrency:l(v))(a.data.amount),disabled:""},null,8,ya)]),e("div",_a,[fa,e("input",{type:"text",class:"border border-gray-200 bg-gray-100 rounded-md",value:a.data.terms_of_payment,disabled:""},null,8,va)]),e("div",ba,[xa,e("input",{type:"text",class:"border border-gray-200 bg-gray-100 rounded-md",value:a.data.purpose,disabled:""},null,8,La)])]),e("div",Aa,[e("div",wa,[ka,e("input",{type:"text",class:"border border-gray-200 bg-gray-100 rounded-md",value:("useFormatCurrency"in o?o.useFormatCurrency:l(v))(a.data.installment_deduction),disabled:""},null,8,Ca)]),e("div",Ra,[Ma,e("input",{type:"text",class:"border border-gray-200 bg-gray-100 rounded-md",value:a.data.deduction_date_start,disabled:""},null,8,qa)]),e("div",Pa,[Ea,e("input",{type:"text",class:"border border-gray-200 bg-gray-100 rounded-md",value:("useFormatCurrency"in o?o.useFormatCurrency:l(v))(a.data.remaining_balance),disabled:""},null,8,Da)])]),e("div",Ta,[e("div",Fa,[Sa,e("input",{type:"text",class:"border border-gray-200 bg-gray-100 rounded-md",value:a.data.created_by_user,disabled:""},null,8,ja)]),e("div",Oa,[Na,e("input",{type:"text",class:"border border-gray-200 bg-gray-100 rounded-md",value:a.data.created_at_human,disabled:""},null,8,Ba)])]),e("div",Ha,[y(D,{approvals:a.data.approvals},null,8,["approvals"])]),a.data.next_approval&&("useCheckIsCurrentUser"in o?o.useCheckIsCurrentUser:l(J))((w=a.data.next_approval)==null?void 0:w.user_id)?(n(),r("div",$a,[y(T,{"deny-remarks":l(m),"onUpdate:denyRemarks":i[0]||(i[0]=d=>H(m)?m.value=d:null),"request-id":a.data.id,onApprove:M,onDeny:q},null,8,["deny-remarks","request-id"])])):x("",!0),a.data.request_status==="Approved"?(n(),r("div",Ga,[e("div",Ia,[Va,a.data.is_fully_paid?x("",!0):(n(),r("button",{key:0,class:"bg-green-500 rounded-md px-4 py-1 text-white hover:bg-green-600 active:bg-green-700",onClick:i[1]||(i[1]=d=>E())},[y(b,{name:"iconoir:hand-card",class:"font-bold text-xl"}),L(" Make Payment ")]))]),a.data.payments.length>0?(n(),r("table",Ua,[Ya,e("tbody",null,[(n(!0),r($,null,G(a.data.payments,d=>(n(),r("tr",{key:d.id,class:"border"},[e("td",Ka,f(("useFormatCurrency"in o?o.useFormatCurrency:l(v))(d.amount_paid)),1),e("td",Wa,f(d.date_paid),1),e("td",za,f(d.payment_type),1),e("td",Ja,f(d.posting_status),1)]))),128))])])):(n(),r("div",Qa,Za))])):x("",!0)]))}}}),pe=C({__name:"InfoModal",props:U({data:{type:Object,required:!0}},{showModal:{required:!1,type:Boolean}}),emits:["update:showModal"],setup(a){const s=Y(a,"showModal"),t=()=>{s.value=!1};return(u,m)=>{const g=ie,c=Q;return n(),K(c,{"show-modal":s.value,"onUpdate:showModal":m[0]||(m[0]=_=>s.value=_),title:"Cash Advance Details"},{body:W(()=>[y(g,{data:a.data,onCloseModal:t},null,8,["data"])]),_:1},8,["show-modal"])}}});export{ge as T,pe as _,ea as u};
