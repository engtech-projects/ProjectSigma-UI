import{_ as T}from"./RequestDetails.C8dzRGuI.js";import{_ as S}from"./LayoutPrint.BjcxelaN.js";import{_ as G}from"./ApprovalDenyButton.2aaI0auR.js";import{_ as U}from"./PsHoverButton.B5SrmACV.js";import{_ as O}from"./PsModal.Bk3xu63Y.js";import{l as P,n as F,q as B,s as I,r as w,B as V,o as f,h as $,w as y,b as p,u as l,c as R,v as q,j as _}from"./entry.32UGFqj-.js";import{a as v,u as j,A as H}from"./Accessibilities.xGffDRXj.js";import{c as g,b as n}from"./CustomFetch.ggXvTdIz.js";const x=P("GenerateAllowances",{state:()=>({isEdit:!1,generateDraftRequest:{isLoading:!1,data:{employees:[],project_id:null,department_id:null,cutoff_start:"",cutoff_end:"",allowance_date:"",total_days:null,charging_type:null,approvals:[]},errorMessage:"",successMessage:""},createAllowanceRequest:{isLoading:!1,data:{},errorMessage:"",successMessage:""},allRequests:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{},errorMessage:"",successMessage:""},myApprovals:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{},errorMessage:"",successMessage:""},myRequests:{isLoading:!1,isLoaded:!1,list:[],params:{},pagination:{},errorMessage:"",successMessage:""},allowanceRecords:{isLoading:!1,data:{},params:{group_type:null,department_id:null,project_id:null,charge_assignment:"",allowance_date:""},errorMessage:"",successMessage:""},errorMessage:""}),actions:{async getAllowanceRecords(){await g("/api/employee-allowance/view-allowance",{method:"GET",params:this.allowanceRecords.params,watch:!1,onRequest:()=>{this.allowanceRecords.isLoading=!0},onResponse:({response:e})=>{this.allowanceRecords.isLoading=!1,e.ok&&(this.allowanceRecords.data=e._data.data)}})},async getOne(e){return await n("/api/allowance-request/resource/"+e,{method:"GET",onResponse:({response:a})=>{if(a.ok)return a._data.data;throw new Error(a._data.message)}})},async getAllRequests(){await g("/api/allowance-request/resource",{method:"GET",params:this.allRequests.params,watch:!1,onRequest:()=>{this.allRequests.isLoaded=!0,this.allRequests.isLoading=!0},onResponse:({response:e})=>{this.allRequests.isLoading=!1,e.ok&&(this.allRequests.list=e._data.data,this.allRequests.pagination={first_page:e._data.links.first,pages:e._data.meta.links,last_page:e._data.links.last})}})},async getMyRequests(){await g("/api/allowance-request/my-requests",{method:"GET",params:this.myRequests.params,watch:!1,onRequest:()=>{this.myRequests.isLoaded=!0,this.myRequests.isLoading=!0},onResponse:({response:e})=>{if(this.myRequests.isLoading=!1,e.ok)this.myRequests.list=e._data.data,this.myRequests.pagination={first_page:e._data.links.first,pages:e._data.meta.links,last_page:e._data.links.last};else throw this.myRequests.errorMessage=e._data.message,new Error(e._data.message)}})},async getMyApprovals(){await g("/api/allowance-request/my-approvals",{method:"GET",params:this.myApprovals.params,watch:!1,onRequest:()=>{this.myApprovals.isLoaded=!0,this.myApprovals.isLoading=!0},onResponse:({response:e})=>{if(this.myApprovals.isLoading=!1,e.ok)this.myApprovals.list=e._data.data,this.myApprovals.successMessage=e._data.message;else throw this.myApprovals.pagination={first_page:e._data.links.first,pages:e._data.meta.links,last_page:e._data.links.last},new Error(e._data.message)}})},async generateDraft(){await n("/api/allowance-request/draft",{method:"POST",body:this.generateDraftRequest.data,onRequest:()=>{this.generateDraftRequest.isLoading=!0},onResponse:({response:e})=>{if(this.generateDraftRequest.isLoading=!1,e.ok)this.createAllowanceRequest.data=e._data.data,this.generateDraftRequest.successMessage=e._data.message;else throw this.generateDraftRequest.errorMessage=e._data.message,new Error(e._data.message)}})},async createRequest(){this.createAllowanceRequest.isLoading||await n("/api/allowance-request/resource",{method:"POST",body:this.createAllowanceRequest.data,onRequest:()=>{this.createAllowanceRequest.isLoading=!0},onResponse:({response:e})=>{if(this.createAllowanceRequest.isLoading=!1,e.ok)this.reloadResources(),this.createAllowanceRequest.successMessage=e._data.message;else throw this.createAllowanceRequest.errorMessage=e._data.message,new Error(e._data.message)}})},async deleteRequest(e){return await n("/api/allowance-request/resource/"+e,{method:"DELETE",watch:!1,onResponse:({response:a})=>{if(a.ok)return this.reloadResources(),a._data.message}})},async approveApprovalForm(e){await n("/api/approvals/approve/GenerateAllowance/"+e,{method:"POST",onResponseError:({response:a})=>{throw new Error(a._data.message)},onResponse:({response:a})=>{if(a.ok)return this.reloadResources(),a._data;throw new Error(a._data.message)}})},async denyApprovalForm(e,a){this.errorMessage="";const t=new FormData;t.append("id",e),t.append("remarks",a),await n("/api/approvals/disapprove/GenerateAllowance/"+e,{method:"POST",body:t,onResponseError:({response:r})=>{throw new Error(r._data.message)},onResponse:({response:r})=>{if(r.ok)return this.reloadResources(),r._data}})},async voidRequest(e,a){const t=new FormData;return t.append("reason_for_void",a),await n("/api/request-voids/void/GenerateAllowance/"+e,{method:"POST",body:t,onResponseError:({response:r})=>{throw new Error(r._data.message)},onResponse:({response:r})=>{if(r.ok)return this.reloadResources(),r._data}})},reloadResources(){const e=this.generateDraftRequest.data,a=[];this.allRequests.isLoaded&&a.push(this.getAllRequests),this.myRequests.isLoaded&&a.push(this.getMyRequests),this.myApprovals.isLoaded&&a.push(this.getMyApprovals),this.$reset(),this.generateDraftRequest.data=e,a.forEach(t=>{t()})}}}),N={key:0,class:"flex gap-2 p-2 justify-end relative"},Q={key:1,class:"flex gap-2 p-2 justify-end relative"},ae={__name:"InfoModal",props:F({data:{type:Object,required:!0}},{showModal:{required:!1,type:Boolean}}),emits:["update:showModal"],setup(e){const a=B(e,"showModal"),t=x(),{remarks:r}=I(t),u=w(""),d=V(),i=w(!1),h=()=>{a.value=!1},A=async o=>{try{i.value=!0,await t.approveApprovalForm(o),d.add({type:"success",text:t.successMessage}),h()}catch(s){d.add({type:"error",text:s||"something went wrong."})}finally{i.value=!1}},k=async o=>{try{i.value=!0,await t.denyApprovalForm(o),d.add({type:"success",text:t.successMessage}),h()}catch(s){d.add({type:"error",text:s||"something went wrong."})}finally{i.value=!1}},M=async o=>{try{i.value=!0;const s=await t.voidRequest(o,u.value);d.add({type:"success",text:(s==null?void 0:s.message)||"Request voided successfully"}),h()}catch(s){d.add({type:"error",text:s.message||"Something went wrong."})}finally{i.value=!1}};return(o,s)=>{const L=T,E=S,b=G,C=U,D=O;return f(),$(D,{"show-modal":a.value,"onUpdate:showModal":s[3]||(s[3]=c=>a.value=c),"is-loading":l(i),title:"Allowance Request"},{body:y(()=>[p(E,null,{default:y(()=>[p(L,{"allowance-data":e.data},null,8,["allowance-data"])]),_:1})]),footer:y(()=>{var c;return[e.data.next_approval&&("useCheckIsCurrentUser"in o?o.useCheckIsCurrentUser:l(v))((c=e.data.next_approval)==null?void 0:c.user_id)?(f(),R("div",N,[p(b,{"deny-remarks":l(r),"onUpdate:denyRemarks":s[0]||(s[0]=m=>q(r)?r.value=m:null),"request-id":e.data.id,onApprove:A,onDeny:k},null,8,["deny-remarks","request-id"])])):_("",!0),("useCheckIsCurrentUser"in o?o.useCheckIsCurrentUser:l(v))(e.data.created_by)&&e.data.request_status.toLowerCase()==="approved"&&("useCheckAccessibility"in o?o.useCheckAccessibility:l(j))([("AccessibilityTypes"in o?o.AccessibilityTypes:l(H)).HRMS_REQUEST_VOID_CREATEREQUEST])?(f(),R("div",Q,[p(C,{remarks:l(u),"onUpdate:remarks":s[1]||(s[1]=m=>q(u)?u.value=m:null),"main-button-title":"Void","main-button-color":"bg-red-600","secondary-title":"Are you sure you want to void this Allowance request?","secondary-button-title":"Submit Void Request","secondary-button-color":"bg-red-600","remarks-title":"Reason for Voiding",onClick:s[2]||(s[2]=m=>M(e.data.id))},null,8,["remarks"])])):_("",!0)]}),_:1},8,["show-modal","is-loading"])}}};export{ae as _,x as u};
